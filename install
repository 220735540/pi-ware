#!/bin/bash

export PW_PREFIX="$HOME/.local"

if [[ "$1" ]]; then
	export PW_PREFIX="$1"
fi

echo "Installing Pi-Ware..."
mkdir -p "$PW_PREFIX/share/applications"
mkdir -p "$PW_PREFIX/share/pi-ware"
mkdir -p "$PW_PREFIX/bin"
rsync -r ./apps "$PW_PREFIX/share/pi-ware"
rsync ./store.py "$PW_PREFIX/bin/pi-ware"
chmod a+x "$PW_PREFIX/bin/pi-ware"
echo $(git rev-parse main) > "$PW_PREFIX/share/pi-ware/version"

if [[ "$PW_PREFIX" == "$HOME/.local" ]]; then
	echo "export PATH=$PW_PREFIX/bin:$PATH" >> $HOME/.bashrc
fi

echo "Creating a desktop entry for Pi-Ware..."
echo "[Desktop Entry]
Name=Pi-Ware
Comment=\"Raspberry Pi app store\"
Exec=sudo python3 $PW_PREFIX/bin/pi-ware
Icon=$PW_PREFIX/share/pixmaps/pi-ware.png
Categories=Utility;
Type=Application
Terminal=false" > "$PW_PREFIX/share/applications/pi-ware.desktop"
echo -e "Done!\nYou can find Pi-Ware in Menu > Accessories > Pi-Ware."
