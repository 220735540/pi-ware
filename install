#!/bin/bash

export ACTION="$1"
export PW_PREFIX="$HOME/.local"

install_echo()
{
	if [[ "$ACTION" != "update" ]]; then
		echo -e "$1"
	fi
}

install_echo "Installing Pi-Ware..."
mkdir -p "$PW_PREFIX/share/applications"
mkdir -p "$PW_PREFIX/share/pi-ware"
mkdir -p "$PW_PREFIX/bin"
rsync -r ./{apps,uninstall,install,update} "$PW_PREFIX/share/pi-ware"
rsync ./store.py "$PW_PREFIX/bin/pi-ware"
chmod a+x "$PW_PREFIX/bin/pi-ware"
echo $(git rev-parse main) > "$PW_PREFIX/share/pi-ware/version"

if [[ "$PW_PREFIX" == "$HOME/.local" ]]; then
	echo "export PATH=$PW_PREFIX/bin:$PATH" >> $HOME/.bashrc
fi

install_echo "Creating a desktop entry for Pi-Ware..."
install_echo "[Desktop Entry]
Name=Pi-Ware
Comment=\"Raspberry Pi app store\"
Exec=sudo python3 $PW_PREFIX/bin/pi-ware
Icon=$PW_PREFIX/share/pixmaps/pi-ware.png
Categories=Utility;
Type=Application
Terminal=false" > "$PW_PREFIX/share/applications/pi-ware.desktop"
install_echo "Done! You can find Pi-Ware in Menu > Accessories > Pi-Ware."
